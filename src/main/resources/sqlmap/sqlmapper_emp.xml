<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- Mybatis에게 Mapper 경로를 적어야 한다 -->
<mapper namespace="com.example.first_spring.mapper.EmpMapper">
	<!-- id = mapper 메소드 이름 -->
	<select id="getEmpList" resultType="EmpVO">
		SELECT
			empno,
			ename,
			job
		FROM emp
	</select>
	<select id="getEmp" resultType="EmpVO">
		SELECT
			ename
		FROM emp
		WHERE empno = #{empNo}
		<!-- MyBatis 문법. 중괄호 안에 mapper의 파라미터와 같은 이름을 적어준다. -->
	</select>
	
	<select id="selectEmpNameAndJob" resultType="EmpVO">
		SELECT
			ename,
			job
		FROM emp
		WHERE ename like '%L%L%'
	</select>
	<select id="selectEnameAndComm" resultType="EmpVO">
		SELECT
			ename,
			comm
		FROM emp
		WHERE comm is null
	</select>
	<select id="selectEnameAndHiredate" resultType="EmpVO">
		SELECT
			ename,
			hiredate 
		FROM emp 
	    WHERE
	        <![CDATA[
			hiredate >= '1980-12-17' 
			and hiredate <= '1982-01-23'
			]]>
	</select>
	
	<select id="selectEmpName" resultType="EmpVO">
		SELECT
			ename
		FROM emp
		<![CDATA[
		WHERE 
			job = #{job}
		and 
			sal >= #{sal}
		]]>
	</select>
	
	<!-- 숙제 0번 -->
	<select id="selectNameAndComm" resultType="EmpVO">
		select 
			ename,
			SAL 
		from emp
		where 
			(DEPTNO = 10 
		or
			DEPTNO = 30)
		and 
			SAL > #{sal}
	</select>
	
	<!-- 숙제 퍼시스턴스 로직 구현 -->
	<!-- 숙제 1번. MGR이 NULL인 사원 이름, 직업, 급여 조회 -->
	<select id="selectIfAll" resultType="EmpVO">
		select 
			*
		from emp
		where MGR is null
	</select>
	<!-- 숙제 2번. 특정 년도에 입사한 사원 이름, 직업, 입사날짜, 급여 조회-->
	<select id="selectYearEmp" resultType="EmpVO">
		select 
			ename,
			job,
			hiredate,
			sal
		from emp
		where date_format(HIREDATE, '%Y') = #{year}
	</select>
	<!-- 숙제 3번. 입사 날짜가12월에 입사한 사원 이름, 급여 조회-->
	<select id="selectMonthEmp" resultType="EmpVO">
		select 
			ename,
			sal
		from emp
		where date_format(HIREDATE, '%m') = #{month}
	</select>
	<!-- 숙제 4번. 특정 job에 속한 사원번호, 사원 이름, 입사날짜 조회 -->
	<select id="selectHiredateEmp" resultType="EmpVO">
		select 
			EMPNO,
			ENAME,
			HIREDATE 
		from emp
		where JOB = #{job} 
	</select>
	<!-- 숙제 5번. 특정 사원의 모든 정보 조회(emp, dept 테이블 조인) -->
	<resultMap type="DeptVO" id="DeptVO">
		<result column="deptno" property="deptno"/>
		<result column="dname" property="dname"/>
		<result column="loc" property="loc"/>
	</resultMap>
	<resultMap type="EmpVO" id="EmpVO">
		<result column="empno" property="empno"/>
		<result column="ename" property="ename"/>
		<result column="job" property="job"/>
		<result column="mgr" property="mgr"/>
		<result column="hiredate" property="hiredate"/>
		<result column="sal" property="sal"/>
		<result column="comm" property="comm"/>
		<result column="deptno" property="deptno"/>
		<collection property="deptVO" resultMap="DeptVO"/>
	</resultMap>
	<select id="selectAllEmpInfo" parameterType="EmpVO" resultMap="EmpVO">
		select 
			e.empno,
			e.ename,
			e.job,
			e.mgr,
			e.hiredate,
			e.sal,
			e.comm,
			e.deptno,
			d.deptno,
			d.dname,
			d.loc
		from emp e
		inner join dept d
		on e.deptno = d.deptno
		where e.empno = #{empno}
	</select>
</mapper>